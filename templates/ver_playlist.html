<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoMusic: {{ playlist.nombre }}</title>
    <link rel="stylesheet" href="/static/styles/ver_playlist.css">
</head>
<body>
    <div class="div_fondo_ver_playlist">
        <header>
            <a class="img_logo" href="{% url 'index' %}"></a>
            <a class="btn_volver" href="{% url 'mis_playlists' %}">← Volver</a>
            <a class="btn_perfil" href="{% url 'perfil' %}"></a>
            <a class="btn_logout" href="{% url 'logout' %}"></a>
        </header>

        <div class="div_contenido">
            <div class="div_header_playlist">
                <img class="imagen_playlist_grande" src="{{ playlist.imagen.url }}" alt="imagen_playlist">
                <div class="div_info_playlist">
                    <p class="tipo_contenido">PLAYLIST</p>
                    <h1 class="titulo_playlist">{{ playlist.nombre }}</h1>
                    <p class="descripcion_playlist">{{ playlist.descripcion }}</p>
                    <p class="info_playlist">{{ canciones_playlist|length }} canciones</p>
                    
                    <div class="div_botones_header">
                        <button class="btn_editar_playlist" type="button" id="btn_editar">Editar</button>
                        <button class="btn_agregar" type="button" id="btn_agregar">+ Agregar Canciones</button>
                        <button class="btn_reordenar" type="button" id="btn_reordenar">⇅ Reordenar</button>
                        <button class="btn_eliminar_playlist" type="button" id="btn_eliminar_playlist">Eliminar Playlist</button>
                    </div>
                </div>
            </div>

            
            <div class="div_canciones">
                <h2 class="subtitulo">Canciones</h2>
                
                {% if canciones_playlist %}
                    <div class="lista_canciones" id="lista_canciones">
                        {% for pc in canciones_playlist %}
                            <div class="item_cancion" data-cancion-id="{{ pc.cancion.id }}">
                                <span class="numero_orden">{{ forloop.counter }}</span>
                                <img class="img_cancion" src="{{ pc.cancion.imagen.url }}" alt="imagen_cancion">
                                <div class="info_cancion">
                                    <p class="nombre_cancion">{{ pc.cancion.nombre }}</p>
                                    <p class="autor_cancion">{{ pc.cancion.autor }}</p>
                                </div>
                                <button class="btn_reproducir imagen_cancion_reproducir" type="button">▶</button>
                                <form action="{% url 'quitar_cancion_playlist' %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
                                    <input type="hidden" name="cancion_id" value="{{ pc.cancion.id }}">
                                    <button class="btn_quitar" type="submit">✕</button>
                                </form>
                                <button class="btn_mover" type="button" style="display: none;">☰</button>
                                <audio class="audio_cancion" src="{{ pc.cancion.archivo.url }}"></audio>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <h3 class="txt_mensaje">Esta playlist está vacía</h3>
                    <p class="txt_submensaje">Agrega canciones para comenzar</p>
                {% endif %}
            </div>
        </div>

        
        <div class="div_reproductor" id="reproductor">
            <div class="reproductor">
                <p class="txt_cancion_seleccionada" id="txt_cancion_seleccionada"></p>
                <audio id="cancion_seleccionada"></audio>
                <div class="div_play_duracion">
                    <button class="btn_play" type="button" id="btn_play"></button>
                    <div class="div_duracion" id="div_duracion">
                        <div class="espacio_consumido" id="espacio_consumido"></div>
                        <button class="btn_duracion" draggable="false" id="btn_duracion"></button>
                    </div>
                </div>
            </div>

            <div class="div_volumen">
                <div class="volumen" id="volumen">
                    <div class="espacio_volumen" id="espacio_volumen"></div>
                    <button class="btn_volumen" draggable="false" id="btn_volumen"></button>
                </div>
            </div>
        </div>
    </div>

    
    <div class="div_fondo" id="div_fondo_agregar">
        <div class="div_agregar_canciones">
            <h1 class="titulo_form">Agregar Canciones</h1>
            <button class="btn_cerrar_modal" id="btn_cerrar_agregar">✕</button>
            
            <div class="lista_todas_canciones">
                {% if todas_canciones %}
                    {% for cancion in todas_canciones %}
                        <form class="item_cancion_agregar" action="{% url 'agregar_cancion_playlist' %}" method="post">
                            {% csrf_token %}
                            <img class="img_cancion_mini" src="{{ cancion.imagen.url }}" alt="imagen_cancion">
                            <div class="info_cancion_agregar">
                                <p class="nombre_cancion_agregar">{{ cancion.nombre }}</p>
                                <p class="autor_cancion_agregar">{{ cancion.autor }}</p>
                            </div>
                            <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
                            <input type="hidden" name="cancion_id" value="{{ cancion.id }}">
                            <button class="btn_agregar_cancion" type="submit">+</button>
                        </form>
                    {% endfor %}
                {% else %}
                    <p class="txt_mensaje">No tienes canciones para agregar</p>
                {% endif %}
            </div>
        </div>
    </div>

    
    <div class="div_fondo" id="div_fondo_editar">
        <form class="div_form" action="{% url 'editar_playlist' %}" enctype="multipart/form-data" method="post">
            {% csrf_token %}
            <h1 class="titulo_form">Editar Playlist</h1>

            <div class="div_image_form">
                <div class="btn_image_hover" id="btn_image_editar_hover"></div>
                <img class="btn_image" src="{{ playlist.imagen.url }}" id="btn_image_editar" alt="imagen_playlist">
            </div>
            
            <input id="input_imagen_editar" type="file" style="display: none;" name="imagen_playlist">
            <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
            <input class="input_form" type="text" maxlength="30" placeholder="Nombre" name="nombre" value="{{ playlist.nombre }}">
            <textarea class="txt_descripcion" name="descripcion" maxlength="100" placeholder="Descripción">{{ playlist.descripcion }}</textarea>

            <div class="div_botones_form">
                <button type="submit" class="btn_aceptar">Guardar</button>
                <button type="button" class="btn_cancelar" id="btn_cancelar_editar">Cancelar</button>
            </div>
        </form>
    </div>

    
    <div class="div_fondo" id="div_fondo_eliminar">
        <div class="div_confirmar">
            <h2 class="titulo_confirmar">¿Eliminar playlist?</h2>
            <p class="texto_confirmar">Esta acción no se puede deshacer</p>
            <form action="{% url 'eliminar_playlist' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
                <div class="div_botones_confirmar">
                    <button type="submit" class="btn_confirmar_eliminar">Eliminar</button>
                    <button type="button" class="btn_cancelar_eliminar" id="btn_cancelar_eliminar">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    
    <form id="form_reordenar" action="{% url 'reordenar_playlist' %}" method="post" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="playlist_id" value="{{ playlist.id }}">
        <div id="inputs_orden"></div>
    </form>

    <script src="/static/scripts/ver_playlist.js"></script>
</body>
</html>